- name: Deploy to EC2
  uses: appleboy/ssh-action@v0.1.6
  with:
    host: ${{ secrets.EC2_HOST }}
    username: ${{ secrets.EC2_USER }}
    key: ${{ secrets.EC2_SSH_KEY }}
    port: 22
    script: |
      set -e
      APP_DIR="/var/www/html/food-project"
      STAGING_DIR="/home/ubuntu/food-project_staging"

      if [ ! -d "$STAGING_DIR/.git" ]; then
        git clone https://github.com/shivamshete92/food-project.git $STAGING_DIR
      else
        cd $STAGING_DIR
        git reset --hard
        git pull origin main
      fi

      sudo rsync -av --delete $STAGING_DIR/ $APP_DIR/
      sudo chown -R www-data:www-data $APP_DIR
      sudo chmod -R 755 $APP_DIR
      sudo systemctl restart apache2

      echo "âœ… Deployment completed!"
